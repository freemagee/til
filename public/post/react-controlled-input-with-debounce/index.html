<!doctype html><html class=no-js lang=en-gb><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>React controlled input with debounce | Front-end web development | Neil Magee</title><meta name=description content="How to write a controlled input in React with debounce effect"><meta name=keywords content><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Neil Magee"><meta name=referrer content="no-referrer-when-downgrade"><meta property="og:title" content="React controlled input with debounce | Front-end web development | Neil Magee"><meta property="og:image" content="https://til.neilmagee.com/images/misc/screenshot.png"><meta property="og:description" content="How to write a controlled input in React with debounce effect"><meta property="og:url" content="https://til.neilmagee.com/post/react-controlled-input-with-debounce/"><link href=/images/favicon/favicon-16x16.png rel="shortcut icon" type=image/png><link rel=stylesheet href=/css/style-b662c601.css><link rel=stylesheet href=/css/code-highlighting-52395fdb.css></head><body><header class=site-header><section class=site-header__ident><a href=https://til.neilmagee.com/ class=site-header__link>TIL</a></section><nav class=site-header__nav><a href=/about class=site-header__nav-item>About</a></nav></header><div class=site-container><div class=site-container__inner><main role=main id=content><article class="post post--single" itemscope itemtype=http://schema.org/BlogPosting><header class=post__header><h1 class="post__title post__title--single" itemprop=title>React controlled input with debounce</h1><div class=post__meta><time class=post__date datetime=2020-03-02 itemprop="dateCreated pubdate datePublished"><span class=post__date-icon><svg id="Calendar" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20" enable-background="new 0 0 20 20"><path d="M17 3h-1v2h-3V3H7v2H4V3H3C1.899 3 1 3.9 1 5v12c0 1.1.899 2 2 2h14c1.1.0 2-.9 2-2V5C19 3.9 18.1 3 17 3zm0 14H3V9h14v8zM6.5 1h-2v3.5h2V1zm9 0h-2v3.5h2V1z" class="post__meta-icon"/></svg></span><span class=post__date-label>2020-03-02</span></time><div class=post__read-time><span class=post__read-time-icon><svg id="Stopwatch" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20" enable-background="new 0 0 20 20"><path d="M7.376 6.745c-.447.275 1.197 4.242 1.598 4.888.35.569 1.093.742 1.658.394.568-.352.745-1.094.395-1.66C10.63 9.719 7.822 6.469 7.376 6.745zM7.041 2.402C7.969 2.079 8.963 1.9 10 1.9s2.031.179 2.959.502c.329.114.765-.115.572-.611-.141-.36-.277-.712-.332-.855-.131-.339-.6-.619-.804-.665C11.623.097 10.823.0 10 0S8.377.097 7.604.271C7.4.317 6.932.597 6.801.936 6.746 1.079 6.609 1.431 6.469 1.791 6.276 2.287 6.712 2.517 7.041 2.402zM19.098 3.186c-.192-.23-.396-.455-.613-.672-.216-.217-.441-.42-.67-.613-.153-.129-.603-.234-.888.051-.284.285-1.648 1.647-1.648 1.647.402.288.793.605 1.155.966.362.361.677.752.966 1.155.0.0 1.363-1.362 1.647-1.647C19.333 3.787 19.228 3.338 19.098 3.186zM10 2.9c-4.475.0-8.101 3.626-8.101 8.1.0 4.475 3.626 8.101 8.101 8.101 4.473.0 8.1-3.626 8.1-8.101C18.1 6.527 14.473 2.9 10 2.9zM10 17.101c-3.368.0-6.1-2.731-6.1-6.1s2.731-6.1 6.1-6.1 6.101 2.731 6.101 6.1C16.101 14.369 13.369 17.101 10 17.101z" class="post__meta-icon"/></svg></span><span class=post__read-time-label>3 min read</span></div><ul class=post__categories><li class=post__category><a href=/categories/development class=post__category-link>development</a></li></ul></div></header><section class=post-content><p>I previously wrote a post about using <a href=https://til.neilmagee.com/post/react-with-debounce/>Lodash debounce with a React component</a>. I recently had to use a controlled input, that needed a debounce effect on it. But the difference between this new component and the one in my previous post was this new component was written in a functional way, using React hooks.</p><p>So the scope for this component would be to take an initial value from it&rsquo;s parent, handle changes in state, and then when the user has stopped typing, after a short delay, to lift the state up to the parent so that the input value can trigger something in the parent.</p><h2 id=immediate-problems>Immediate problems</h2><p>After writing the new component to use Lodash debounce, and taking advantage of <code>useEffect</code> to trigger side effects based on the input value changing I immediately saw a problem. I have increased the debounce &ldquo;delay&rdquo; to two seconds to exaggerate the effect.</p><figure><img src=/images/react-controlled-input-with-debounce/debounce-fail.gif alt="Animated gif showing a debounce not working correctly" loading=lazy><figcaption><h4>Debounce gone wrong!</h4></figcaption></figure><p>What is happening here, is as the user types, the debounce is being triggered after every value change. So each letter is passed to the parent two seconds after is was typed. So from the <strong>gif</strong> you can see the parent receiving the new value one letter at a time. This is clearly not right.</p><h2 id=trying-to-fix-the-issue>Trying to fix the issue</h2><p>I tried a few different methods, experimented with <code>event.persist()</code>, over-complicated my <code>useEffect</code>, but I could not get Lodash debounce to work the way I wanted in this instance.</p><p>So I took a step back and thought about it from the ground up. Debounce&rsquo;s main action is like a <code>setTimeout</code> (<a href=https://lodash.com/docs/4.17.15#debounce>there <em>is</em> more to it</a>). So with that in mind I looked to re-write the component without Lodash. This eventually led me to make this component.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>useState</span><span class=p>,</span> <span class=nx>useEffect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
<span class=kr>import</span> <span class=nx>PropTypes</span> <span class=nx>from</span> <span class=s2>&#34;prop-types&#34;</span><span class=p>;</span>

<span class=nx>DelayedInput</span><span class=p>.</span><span class=nx>propTypes</span> <span class=o>=</span> <span class=p>{</span>
  <span class=nx>type</span><span class=o>:</span> <span class=nx>PropTypes</span><span class=p>.</span><span class=nx>string</span><span class=p>,</span>
  <span class=nx>initialValue</span><span class=o>:</span> <span class=nx>PropTypes</span><span class=p>.</span><span class=nx>string</span><span class=p>,</span>
  <span class=nx>inputDelay</span><span class=o>:</span> <span class=nx>PropTypes</span><span class=p>.</span><span class=nx>number</span><span class=p>,</span>
  <span class=nx>placeHolder</span><span class=o>:</span> <span class=nx>PropTypes</span><span class=p>.</span><span class=nx>string</span><span class=p>,</span>
  <span class=nx>setInput</span><span class=o>:</span> <span class=nx>PropTypes</span><span class=p>.</span><span class=nx>func</span><span class=p>.</span><span class=nx>isRequired</span>
<span class=p>};</span>

<span class=kd>function</span> <span class=nx>DelayedInput</span><span class=p>({</span>
  <span class=nx>type</span> <span class=o>=</span> <span class=s2>&#34;text&#34;</span><span class=p>,</span>
  <span class=nx>initialValue</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
  <span class=nx>inputDelay</span> <span class=o>=</span> <span class=mi>300</span><span class=p>,</span>
  <span class=nx>placeHolder</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
  <span class=nx>setInput</span>
<span class=p>})</span> <span class=p>{</span>
  <span class=kr>const</span> <span class=p>[</span><span class=nx>value</span><span class=p>,</span> <span class=nx>setValue</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=nx>initialValue</span><span class=p>);</span>

  <span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>timer</span> <span class=o>=</span> <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=nx>setInput</span><span class=p>(</span><span class=nx>value</span><span class=p>);</span>
    <span class=p>},</span> <span class=nx>inputDelay</span><span class=p>);</span>
    <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timer</span><span class=p>);</span>
  <span class=p>},</span> <span class=p>[</span><span class=nx>value</span><span class=p>,</span> <span class=nx>inputDelay</span><span class=p>,</span> <span class=nx>setInput</span><span class=p>]);</span>

  <span class=kd>function</span> <span class=nx>handleChange</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>setValue</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
  <span class=p>}</span>

  <span class=kr>const</span> <span class=nx>theValue</span> <span class=o>=</span> <span class=nx>value</span><span class=p>;</span>

  <span class=k>return</span> <span class=p>(</span>
    <span class=o>&lt;</span><span class=nx>input</span>
      <span class=nx>type</span><span class=o>=</span><span class=p>{</span><span class=nx>type</span><span class=p>}</span>
      <span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>theValue</span><span class=p>}</span>
      <span class=nx>placeholder</span><span class=o>=</span><span class=p>{</span><span class=nx>placeHolder</span><span class=p>}</span>
      <span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleChange</span><span class=p>}</span>
    <span class=o>/&gt;</span>
  <span class=p>);</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>DelayedInput</span><span class=p>;</span>
</code></pre></div><p>When the <code>useEffect</code> recognises a change to <code>value</code>, a new timer is created. If no more <code>value</code> changes are detected, that timer completes and the state is lifted up to the parent. If a <code>value</code> change is detected, the timer is reset and it once again waits for more changes and completes if there are none.</p><p><strong>Below</strong> shows the parent receives its text in one go. Again I have increased the debounce &ldquo;delay&rdquo; to two seconds to exaggerate the effect. In production the delay is 300ms.</p><figure><img src=/images/react-controlled-input-with-debounce/debounce-success.gif alt="Animated gif showing a debounce working as expected" loading=lazy><figcaption><h4>Debounce working correctly</h4></figcaption></figure><p>I put this together as a demo on Github as <a href=https://github.com/freemagee/react-debounced-input>React Debounced Input</a>. You can see it in action <a href=https://freemagee.github.io/react-debounced-input/>here</a>.</p></section><footer class=post__footer><ul class=post__tags><li class=post__tag><a href=/tags/react class=post__tag-link><span class=post__tag-label>#</span>react</a></li></ul></footer></article><aside class=post-siblings><nav class=post-siblings__ctrl><a class="post-siblings__nav post-siblings__nav--next" href=https://til.neilmagee.com/post/hugo-content-organisation/ rel=nofollow><span class=post-siblings__nav-icon><svg id="Chevron_left" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20" enable-background="new 0 0 20 20"><path d="M12.452 4.516c.446.436.481 1.043.0 1.576L8.705 10l3.747 3.908c.481.533.446 1.141.0 1.574-.445.436-1.197.408-1.615.0-.418-.406-4.502-4.695-4.502-4.695C6.112 10.57 6 10.285 6 10s.112-.57.335-.789c0 0 4.084-4.287 4.502-4.695C11.255 4.107 12.007 4.08 12.452 4.516z" class="post-siblings__nav-icon-next"/></svg></span>Next</a>
<a class="post-siblings__nav post-siblings__nav--previous" href=https://til.neilmagee.com/post/tailwindcss-configs/ rel=nofollow>Previous<span class=post-siblings__nav-icon><svg id="Chevron_right" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 20 20" enable-background="new 0 0 20 20"><path d="M9.163 4.516c.418.408 4.502 4.695 4.502 4.695C13.888 9.43 14 9.715 14 10s-.112.57-.335.787c0 0-4.084 4.289-4.502 4.695-.418.408-1.17.436-1.615.0-.446-.434-.481-1.041.0-1.574L11.295 10 7.548 6.092c-.481-.533-.446-1.141.0-1.576C7.993 4.08 8.745 4.107 9.163 4.516z" class="post-siblings__nav-icon-previous"/></svg></span></a></nav><span class=post-siblings__more>More posts</span></aside></main><footer class=site-footer><div class=site-footer__inner><p class=site-footer__copyright>&copy; 2020&nbsp;<a href=https://neilmagee.com>Neil Magee</a>
. Icons from <a href=http://entypo.com>Entypo+</a>. Made with <a href=https://gohugo.io/ class=site-footer__hugo-logo><img src=/images/hugo-logo.png alt="Hugo logo" width=22 height=22></a></p></div></footer></div></div><script src=/js/highlight.pack.js></script><script>document.addEventListener("DOMContentLoaded",event=>{document.documentElement.classList.remove("no-js");document.querySelectorAll("pre:not(.chroma) code").forEach(block=>{hljs.highlightBlock(block);});});</script></body></html>